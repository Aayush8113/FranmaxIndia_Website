"use strict";(self.webpackChunkmyapp=self.webpackChunkmyapp||[]).push([[4984],{3113:()=>{},8693:(e,a,t)=>{t.r(a),t.d(a,{default:()=>c});var s=t(9379),n=t(5043),i=(t(3113),t(8537)),r=t(3862),l=t(579);function c(){const[e,a]=(0,n.useState)([]),[t,c]=(0,n.useState)(null),[o,d]=(0,n.useState)(!0),[u,h]=(0,n.useState)(null),[m,g]=(0,n.useState)({}),[p,x]=(0,n.useState)(!1),[j,v]=(0,n.useState)(1),[f,y]=(0,n.useState)(null),[b,S]=(0,n.useState)(!1),[C,_]=(0,n.useState)(null),[N,w]=(0,n.useState)([]),[A,k]=(0,n.useState)(""),[P,I]=(0,n.useState)(!1),[E,O]=(0,n.useState)([]),[F,D]=(0,n.useState)({}),[T,q]=(0,n.useState)({}),M=["Prospecting","Negotiation","Closed Won","Closed Lost"],U=["New","Contacted","Qualified","Disqualified","Working"],L=[{id:1,name:"Sponsorship"},{id:2,name:"Co Sponsorship"},{id:3,name:"Title Sponsor"},{id:4,name:"Premium Stall"},{id:5,name:"General Stall"},{id:6,name:"Onboarding"},{id:7,name:"FDP"},{id:8,name:"MNR"},{id:9,name:"Recruitment"}],B=(e,a,t)=>{g(n=>(0,s.A)((0,s.A)({},n),{},{[e]:(0,s.A)((0,s.A)({},n[e]),{},{[a]:t})}))};(0,n.useEffect)(()=>{(async()=>{try{const e=await fetch((0,r.e)("get-master-category.php")),a=await e.json();Array.isArray(a)&&O(a.filter(e=>"0"===e.is_deleted))}catch(e){console.error("Error fetching master categories:",e)}})()},[]);const J=async e=>{if(!e||F[e])return F[e]||[];try{const a=await fetch((0,r.e)("get-category.php?mas_cat_id=".concat(e))),t=await a.json();return D(a=>(0,s.A)((0,s.A)({},a),{},{[e]:t})),t}catch(a){return console.error("Error fetching categories:",a),[]}},R=async e=>{if(e&&!T[e])try{const a=await fetch((0,r.e)("get-sub-category.php?cat_id=".concat(e))),t=await a.json();q(a=>(0,s.A)((0,s.A)({},a),{},{[e]:t}))}catch(a){console.error("Error fetching subcategories:",a)}};(0,n.useEffect)(()=>{(async()=>{if(t){const a=e.find(e=>e.id===t);if(a&&a.masterCategory){const e=E.find(e=>e.mas_cat_name===a.masterCategory);if(e){const t=await J(e.mas_cat_id);if(a.category){const e=t.find(e=>e.cat_name===a.category);e&&await R(e.cat_id)}}}}})()},[t,e,E]);const W=(a,t,s)=>{var n,i,r;const c=null!==(n=null!==(i=null===(r=m[a])||void 0===r?void 0:r[t])&&void 0!==i?i:s)&&void 0!==n?n:"";if(t.toLowerCase().includes("date"))return(0,l.jsx)("input",{type:"date",value:c,onChange:e=>B(a,t,e.target.value)});if(t.toLowerCase().includes("time"))return(0,l.jsx)("input",{type:"time",value:c,onChange:e=>B(a,t,e.target.value)});if("product"===t)return(0,l.jsxs)("select",{value:c,onChange:e=>B(a,t,e.target.value),children:[(0,l.jsx)("option",{value:"",children:"Select Product"}),L.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.id))]});if("stage"===t)return(0,l.jsxs)("select",{value:c,onChange:e=>B(a,t,e.target.value),children:[(0,l.jsx)("option",{value:"",children:"Select Stage"}),M.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]});if("status"===t)return(0,l.jsxs)("select",{value:c,onChange:e=>B(a,t,e.target.value),children:[(0,l.jsx)("option",{value:"",children:"Select Status"}),U.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]});if("masterCategory"===t)return(0,l.jsxs)("select",{value:c,onChange:e=>{const s=e.target.value,n=E.find(e=>e.mas_cat_name===s);B(a,t,s),B(a,"category",""),B(a,"subCategory",""),n&&J(n.mas_cat_id)},children:[(0,l.jsx)("option",{value:"",children:"Select Master Category"}),E.map(e=>(0,l.jsx)("option",{value:e.mas_cat_name,children:e.mas_cat_name},e.mas_cat_id))]});if("category"===t){var o,d;const s=(null===(o=m[a])||void 0===o?void 0:o.masterCategory)||(null===(d=e.find(e=>e.id===a))||void 0===d?void 0:d.masterCategory)||"",n=E.find(e=>e.mas_cat_name===s),i=n&&F[n.mas_cat_id]||[];return(0,l.jsxs)("select",{value:c,onChange:e=>{const s=e.target.value,n=i.find(e=>e.cat_name===s);B(a,t,s),B(a,"subCategory",""),n&&R(n.cat_id)},disabled:!n,children:[(0,l.jsx)("option",{value:"",children:"Select Category"}),i.map(e=>(0,l.jsx)("option",{value:e.cat_name,children:e.cat_name},e.cat_id))]})}if("subCategory"===t){var u,h,g,p;const s=(null===(u=m[a])||void 0===u?void 0:u.category)||(null===(h=e.find(e=>e.id===a))||void 0===h?void 0:h.category)||"",n=(null===(g=m[a])||void 0===g?void 0:g.masterCategory)||(null===(p=e.find(e=>e.id===a))||void 0===p?void 0:p.masterCategory)||"",i=E.find(e=>e.mas_cat_name===n),r=(i&&F[i.mas_cat_id]||[]).find(e=>e.cat_name===s),o=r&&T[r.cat_id]||[];return(0,l.jsxs)("select",{value:c,onChange:e=>B(a,t,e.target.value),disabled:!r,children:[(0,l.jsx)("option",{value:"",children:"Select Subcategory"}),o.map(e=>(0,l.jsx)("option",{value:e.subcat_name,children:e.subcat_name},e.subcat_id))]})}return(0,l.jsx)("input",{type:"text",value:c,onChange:e=>B(a,t,e.target.value)})},G=async()=>{if(!A)return alert("Please select a user first");try{I(!0);const t={inquiry_id:C,user_id:A},n=await fetch((0,r.e)("assign-inquiry.php"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),i=await n.json();n.ok&&i.success?(alert(i.message||"Assigned successfully"),a(e.map(e=>e.id===C?(0,s.A)((0,s.A)({},e),{},{assignedUserId:A}):e)),_(null),k("")):alert(i.message||"Failed to assign")}catch(t){console.error("Assign error:",t),alert("Something went wrong while assigning.")}finally{I(!1)}};(0,n.useEffect)(()=>{(async()=>{try{const e=localStorage.getItem("adminId"),t=await fetch((0,r.e)("get-inhouse-brands.php?user_id=".concat(e))),s=await t.json();a(s),d(!1)}catch(e){h("Failed to fetch inquiries."),d(!1)}})()},[]);const H=Math.ceil(e.length/10),Q=10*(j-1),V=e.slice(Q,Q+10);return(0,l.jsxs)("div",{className:"dashboard-container",children:[(0,l.jsx)(i.A,{}),(0,l.jsxs)("div",{className:"main-content",children:[(0,l.jsx)("h2",{className:"table-title",children:"Inhouse Brands"}),"1"===localStorage.getItem("adminId")&&(0,l.jsxs)("div",{className:"upload-box",children:[(0,l.jsx)("input",{type:"file",accept:".xls,.xlsx",onChange:e=>y(e.target.files[0])}),(0,l.jsx)("button",{onClick:async()=>{if(!f)return alert("Please select an Excel file first.");try{S(!0);const e=new FormData;e.append("file",f);const t=await fetch((0,r.e)("upload-inhouse-brands.php"),{method:"POST",body:e}),s=await t.json();if(alert(s.message),s.success){const e=localStorage.getItem("adminId"),t=await fetch((0,r.e)("get-inhouse-brands.php?user_id=".concat(e))),s=await t.json();a(s)}}catch(e){console.error("Upload error:",e),alert("Error uploading file.")}finally{S(!1),y(null)}},disabled:b,className:"upload-btn",children:b?"Uploading...":"Upload Excel"})]}),o&&(0,l.jsx)("div",{className:"loading",children:"Loading..."}),u&&(0,l.jsx)("div",{className:"error",children:u}),!o&&!u&&(0,l.jsxs)("div",{className:"table-wrapper",children:[(0,l.jsxs)("table",{className:"inquiry-table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"id-col",children:"ID"}),(0,l.jsx)("th",{children:"Brand Name"}),(0,l.jsx)("th",{children:"Owner Name"}),(0,l.jsx)("th",{children:"Contact Person"}),(0,l.jsx)("th",{className:"phone-col",children:"Contact Number"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:V.map(i=>(0,l.jsxs)(n.Fragment,{children:[(0,l.jsxs)("tr",{className:"summary-row ".concat(t===i.id?"expanded-row":""),children:[(0,l.jsx)("td",{className:"id-col",children:i.id}),(0,l.jsx)("td",{children:i.brandName}),(0,l.jsx)("td",{children:i.ownerName}),(0,l.jsx)("td",{children:i.contactPersonName}),(0,l.jsx)("td",{className:"phone-col",children:i.contactPersonNumber}),(0,l.jsxs)("td",{children:[(0,l.jsx)("button",{onClick:()=>{return e=i.id,c(t===e?null:e),void _(null);var e},className:"expand-btn",children:t===i.id?"Hide Details":"View Details"}),"1"===localStorage.getItem("adminId")&&(0,l.jsx)("button",{onClick:()=>(async e=>{_(e),k("");try{const e=await fetch((0,r.e)("get-user-name.php")),a=await e.json();a.success?w(a.data):alert("Failed to fetch users")}catch(a){console.error("Assign fetch error:",a),alert("Error fetching users")}})(i.id),className:"assign-btn",children:"Assign"})]})]}),t===i.id&&(0,l.jsx)("tr",{className:"details-row",children:(0,l.jsx)("td",{colSpan:"6",children:(0,l.jsxs)("div",{className:"details-box",children:[C===i.id&&N.length>0&&(0,l.jsxs)("div",{className:"assign-box",children:[(0,l.jsxs)("label",{children:["Assign to:",(0,l.jsxs)("select",{value:A,onChange:e=>k(e.target.value),children:[(0,l.jsx)("option",{value:"",children:"Select User"}),N.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,l.jsx)("button",{onClick:G,className:"confirm-btn",disabled:P,children:P?"Assigning...":"Confirm"})]}),(0,l.jsx)("div",{className:"details-grid",children:Object.keys(i).map(e=>["id","brandName","ownerName","contactPerson","contactNumber"].includes(e)?null:(0,l.jsxs)("div",{className:"detail-item",children:[(0,l.jsxs)("label",{children:[e,":"]}),W(i.id,e,i[e])]},e))}),(0,l.jsx)("button",{className:"save-btn",onClick:()=>(async t=>{try{x(!0);const n=(0,s.A)({id:t},m[t]),i=await fetch((0,r.e)("update-inhouse-brand.php"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),l=await i.json();i.ok&&l.success?(alert(l.message||"Saved successfully"),a(e.map(e=>e.id===t?(0,s.A)((0,s.A)({},e),m[t]):e)),g(e=>{const a=(0,s.A)({},e);return delete a[t],a})):alert(l.message||"Failed to save data")}catch(n){console.error("Save error:",n),alert("Something went wrong while saving.")}finally{x(!1)}})(i.id),disabled:p,children:p?"Saving...":"Save"})]})})})]},i.id))})]}),H>1&&(0,l.jsxs)("div",{className:"pagination",children:[(0,l.jsx)("button",{onClick:()=>v(e=>Math.max(e-1,1)),disabled:1===j,children:"Prev"}),(()=>{const e=[];for(let a=1;a<=H;a++)e.push(a);return e})().map(e=>(0,l.jsx)("button",{className:j===e?"active":"",onClick:()=>v(e),children:e},e)),(0,l.jsx)("button",{onClick:()=>v(e=>Math.min(e+1,H)),disabled:j===H,children:"Next"})]})]})]})]})}}}]);
//# sourceMappingURL=4984.ce13b9d6.chunk.js.map